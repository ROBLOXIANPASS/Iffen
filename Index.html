<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RobuxStore | Painel de Pedidos</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0e;
            --card: #12121a;
            --accent: #00c3ff;
            --green: #00ff88;
            --text: #ffffff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { width: 100%; max-width: 400px; }
        header { text-align: center; margin-bottom: 20px; }
        header h1 span { color: var(--accent); }
        .shop-card {
            background: var(--card);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid #1f1f2e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        .profile-preview {
            display: none;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #08080c;
            border-radius: 15px;
            border: 2px solid var(--accent);
            animation: fadeIn 0.5s ease;
        }
        .profile-preview img { 
            width: 90px; height: 90px; 
            border-radius: 50%; 
            border: 3px solid var(--accent); 
            background: #000;
            margin-bottom: 10px;
            object-fit: cover;
        }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        label { display: block; font-size: 0.7rem; color: #666; margin-bottom: 5px; text-transform: uppercase; font-weight: bold; }
        input {
            width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #1f1f2e;
            background: #08080c; color: #fff; margin-bottom: 15px; font-size: 0.9rem;
        }
        .display-result {
            background: #181825; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px;
        }
        .robux-count { display: block; font-size: 2.2rem; font-weight: 900; }
        .btn-send {
            width: 100%; padding: 16px; border-radius: 10px; border: none;
            background: var(--accent); color: #fff; font-weight: 800; font-size: 1rem; cursor: pointer;
        }
        .btn-send:disabled { opacity: 0.2; cursor: not-allowed; }
        .error-msg { color: #ff4444; font-size: 0.75rem; margin-top: -10px; margin-bottom: 10px; display: none; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ROBUX<span>LOJA</span></h1>
        </header>

        <div class="shop-card">
            <div class="profile-preview" id="previewArea">
                <img src="" id="userPhoto" alt="Avatar">
                <p style="font-size: 0.8rem; color: var(--accent); font-weight: bold;">CONTA IDENTIFICADA</p>
            </div>

            <label>1. Link do Perfil Roblox</label>
            <input type="text" id="profileLink" placeholder="Cole o link do seu perfil...">

            <label>2. Quanto quer pagar (R$)</label>
            <input type="number" id="amount" placeholder="M√≠nimo R$ 15,00">
            <p id="valError" class="error-msg">Valor m√≠nimo de R$ 15,00 necess√°rio.</p>

            <label>3. Link da Gamepass</label>
            <input type="text" id="gamepassLink" placeholder="Link da Gamepass configurada">

            <div class="display-result">
                <span style="font-size: 0.6rem; color: var(--accent);">VOC√ä RECEBER√Å</span>
                <span class="robux-count" id="robuxTotal">0</span>
                <span style="color: var(--green); font-weight: bold;">R$ <span id="cashDisplay">0,00</span></span>
            </div>

            <button id="mainBtn" class="btn-send" disabled>FINALIZAR PEDIDO</button>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES ATUALIZADAS
        const BOT_TOKEN = "8270859221:AAFbhwZrsw5Kn7fPE_YoPhcRZe8R0BqNzzU"; 
        const CHAT_ID = "-5137417613"; 

        const linkInput = document.getElementById('profileLink');
        const amountInput = document.getElementById('amount');
        const passInput = document.getElementById('gamepassLink');
        const robuxTotal = document.getElementById('robuxTotal');
        const mainBtn = document.getElementById('mainBtn');
        const previewArea = document.getElementById('previewArea');
        const userPhoto = document.getElementById('userPhoto');

        const RATE = 0.04; 

        // Captura Autom√°tica da Foto (Corrigida com Proxy)
        linkInput.addEventListener('input', async () => {
            const url = linkInput.value;
            const match = url.match(/users\/(\d+)/);
            
            if (match && match[1]) {
                const userId = match[1];
                const thumbApi = `https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${userId}&size=150x150&format=Png&isCircular=true`;
                
                try {
                    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(thumbApi)}`;
                    const response = await fetch(proxyUrl);
                    const data = await response.json();
                    const content = JSON.parse(data.contents);
                    
                    if (content.data && content.data[0]) {
                        userPhoto.src = content.data[0].imageUrl;
                        previewArea.style.display = 'flex';
                    }
                } catch (e) {
                    console.log("Erro ao carregar avatar");
                }
            } else {
                previewArea.style.display = 'none';
            }
            validate();
        });

        function validate() {
            const val = parseFloat(amountInput.value);
            const hasId = previewArea.style.display === 'flex';
            const hasPass = passInput.value.trim().length > 5;
            const valOk = (val >= 15 && val <= 200);

            if (val > 0) {
                robuxTotal.innerText = Math.floor(val / RATE).toLocaleString();
                document.getElementById('cashDisplay').innerText = val.toFixed(2).replace('.', ',');
            }
            
            document.getElementById('valError').style.display = (val > 0 && !valOk) ? 'block' : 'none';
            mainBtn.disabled = !(valOk && hasId && hasPass);
        }

        amountInput.addEventListener('input', validate);
        passInput.addEventListener('input', validate);

        // Envio do Pedido
        mainBtn.addEventListener('click', async () => {
            mainBtn.disabled = true;
            mainBtn.innerText = "ENVIANDO...";

            const msg = `üöÄ *NOVO PEDIDO DE ROBUX*\n\n` +
                        `üë§ *User:* ${linkInput.value}\n` +
                        `üí∞ *Valor:* R$ ${amountInput.value}\n` +
                        `üíé *Robux:* ${robuxTotal.innerText}\n` +
                        `üéüÔ∏è *Gamepass:* ${passInput.value}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        chat_id: CHAT_ID, 
                        text: msg, 
                        parse_mode: "Markdown" 
                    })
                });
                
                if (response.ok) {
                    alert("Pedido enviado com sucesso para o grupo!");
                    // Redireciona para o seu perfil para fechar o pagamento
                    window.location.href = "https://t.me/LIL7809"; 
                } else {
                    const errorData = await response.json();
                    alert("Erro do Telegram: " + errorData.description);
                    mainBtn.disabled = false;
                    mainBtn.innerText = "FINALIZAR PEDIDO";
                }
            } catch (e) {
                alert("Erro de conex√£o. Verifique se o Bot √© ADMIN do grupo.");
                mainBtn.disabled = false;
                mainBtn.innerText = "FINALIZAR PEDIDO";
            }
        });
    </script>
</body>
</html>
